module.exports=[68906,e=>{"use strict";var t=e.i(90793);let r=(e=new Map,t=null,r)=>({nextPart:e,validators:t,classGroupId:r}),n=(e,t,r,n)=>{let a=e.length;for(let s=0;s<a;s++)i(e[s],t,r,n)},i=(e,t,r,n)=>{"string"==typeof e?a(e,t,r):"function"==typeof e?s(e,t,r,n):o(e,t,r,n)},a=(e,t,r)=>{(""===e?t:d(t,e)).classGroupId=r},s=(e,t,r,i)=>{l(e)?n(e(i),t,r,i):(null===t.validators&&(t.validators=[]),t.validators.push({classGroupId:r,validator:e}))},o=(e,t,r,i)=>{let a=Object.entries(e),s=a.length;for(let e=0;e<s;e++){let[s,o]=a[e];n(o,d(t,s),r,i)}},d=(e,t)=>{let n=e,i=t.split("-"),a=i.length;for(let e=0;e<a;e++){let t=i[e],a=n.nextPart.get(t);a||(a=r(),n.nextPart.set(t,a)),n=a}return n},l=e=>"isThemeGetter"in e&&!0===e.isThemeGetter;async function p(e,r){let n,i,a=crypto.randomUUID(),s=(n=Date.now(),i=Math.floor(1e3*Math.random()),`GB-${n}-${i}`);for(let n of(await (0,t.executeDB)(e,`INSERT INTO orders (
      id, order_number, user_id, email, payment_method, payment_intent_id,
      subtotal, shipping_cost, tax, total, currency, shipping_region_id,
      shipping_name, shipping_address_line1, shipping_address_line2,
      shipping_city, shipping_postal_code, shipping_country, shipping_phone
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[a,s,r.userId||null,r.email,r.paymentMethod||null,r.paymentIntentId||null,r.subtotal,r.shippingCost,r.tax,r.total,r.currency||"SEK",r.shippingRegionId||null,r.shippingName,r.shippingAddressLine1,r.shippingAddressLine2||null,r.shippingCity,r.shippingPostalCode,r.shippingCountry,r.shippingPhone||null]),r.items)){let r=crypto.randomUUID();await (0,t.executeDB)(e,`INSERT INTO order_items (
        id, order_id, product_id, variant_id, product_name, variant_name,
        sku, price, quantity, total
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[r,a,n.productId,n.variantId||null,n.productName,n.variantName||null,n.sku||null,n.price,n.quantity,n.price*n.quantity])}let o=await u(e,a);if(!o)throw Error("Failed to create order");return o}async function u(e,r){return await (0,t.queryOne)(e,"SELECT * FROM orders WHERE id = ?",[r])}async function c(e,r){return await (0,t.queryOne)(e,"SELECT * FROM orders WHERE order_number = ?",[r])}async function h(e,r){return(await (0,t.queryDB)(e,"SELECT * FROM order_items WHERE order_id = ? ORDER BY created_at ASC",[r])).results||[]}async function _(e,r){return(await (0,t.queryDB)(e,"SELECT * FROM orders WHERE user_id = ? ORDER BY created_at DESC",[r])).results||[]}e.s(["createOrder",()=>p,"getOrderByNumber",()=>c,"getOrderItems",()=>h,"getOrdersByUserId",()=>_],68906)}];

//# sourceMappingURL=lib_db_queries_orders_ts_aa2376bd._.js.map