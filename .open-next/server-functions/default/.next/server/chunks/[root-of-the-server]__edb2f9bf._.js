module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},90793,e=>{"use strict";async function t(e,r,n=[]){return await e.prepare(r).bind(...n).all()}async function r(e,t,n=[]){return await e.prepare(t).bind(...n).first()||null}async function n(e,t,r=[]){return await e.prepare(t).bind(...r).run()}e.s(["executeDB",()=>n,"queryDB",()=>t,"queryOne",()=>r])},19012,e=>{"use strict";var t=e.i(90793);async function r(e,n={}){let a="SELECT * FROM products WHERE 1=1",i=[];return n.categoryId&&(a+=" AND category_id = ?",i.push(n.categoryId)),n.status&&(a+=" AND status = ?",i.push(n.status)),void 0!==n.featured&&(a+=" AND featured = ?",i.push(+!!n.featured)),a+=" ORDER BY created_at DESC",n.limit&&(a+=" LIMIT ?",i.push(n.limit)),n.offset&&(a+=" OFFSET ?",i.push(n.offset)),(await (0,t.queryDB)(e,a,i)).results||[]}async function n(e,r){return await (0,t.queryOne)(e,"SELECT * FROM products WHERE slug = ?",[r])}async function a(e,r){return await (0,t.queryOne)(e,"SELECT * FROM products WHERE id = ?",[r])}async function i(e,r){return(await (0,t.queryDB)(e,"SELECT * FROM product_variants WHERE product_id = ? ORDER BY created_at ASC",[r])).results||[]}async function s(e,r,n){let a="SELECT * FROM product_images WHERE product_id = ?",i=[r];return n&&(a+=" AND (variant_id = ? OR variant_id IS NULL)",i.push(n)),a+=" ORDER BY sort_order ASC, created_at ASC",(await (0,t.queryDB)(e,a,i)).results||[]}async function o(e,r){let n="SELECT * FROM categories WHERE 1=1",a=[];return null===r?n+=" AND parent_id IS NULL":r&&(n+=" AND parent_id = ?",a.push(r)),n+=" ORDER BY sort_order ASC, name_en ASC",(await (0,t.queryDB)(e,n,a)).results||[]}async function u(e,r){return await (0,t.queryOne)(e,"SELECT * FROM categories WHERE slug = ?",[r])}async function d(e,r){return await (0,t.queryOne)(e,"SELECT * FROM categories WHERE id = ?",[r])}async function p(e,r){return await (0,t.queryOne)(e,"SELECT * FROM product_variants WHERE id = ?",[r])}e.s(["getCategories",()=>o,"getCategoryById",()=>d,"getCategoryBySlug",()=>u,"getProductById",()=>a,"getProductBySlug",()=>n,"getProductImages",()=>s,"getProductVariant",()=>p,"getProductVariants",()=>i,"getProducts",()=>r])},30588,e=>{"use strict";var t=e.i(90793);async function r(e,n=!0){let a="SELECT * FROM shipping_regions";return n&&(a+=" WHERE active = 1"),a+=" ORDER BY name_en ASC",(await (0,t.queryDB)(e,a,[])).results||[]}async function n(e,r){return await (0,t.queryOne)(e,"SELECT * FROM shipping_regions WHERE code = ? AND active = 1",[r])}async function a(e,r){return await (0,t.queryOne)(e,"SELECT * FROM shipping_regions WHERE id = ?",[r])}function i(e,t){return e.free_shipping_threshold&&t>=e.free_shipping_threshold?0:e.base_price}e.s(["calculateShippingCost",()=>i,"getShippingRegionByCode",()=>n,"getShippingRegionById",()=>a,"getShippingRegions",()=>r])},23730,e=>{"use strict";var t=e.i(90793);async function r(e,r,n){if(!r&&!n)return[];let a="SELECT * FROM cart_items WHERE",i=[];return r?(a+=" user_id = ?",i.push(r)):n&&(a+=" session_id = ?",i.push(n)),a+=" ORDER BY created_at ASC",(await (0,t.queryDB)(e,a,i)).results||[]}async function n(e,r){let n=crypto.randomUUID();await (0,t.executeDB)(e,`INSERT INTO cart_items (id, user_id, session_id, product_id, variant_id, quantity)
     VALUES (?, ?, ?, ?, ?, ?)`,[n,r.userId||null,r.sessionId||null,r.productId,r.variantId||null,r.quantity])}async function a(e,r,n){await (0,t.executeDB)(e,"UPDATE cart_items SET quantity = ?, updated_at = unixepoch() WHERE id = ?",[n,r])}async function i(e,r){await (0,t.executeDB)(e,"DELETE FROM cart_items WHERE id = ?",[r])}async function s(e,r,n){r?await (0,t.executeDB)(e,"DELETE FROM cart_items WHERE user_id = ?",[r]):n&&await (0,t.executeDB)(e,"DELETE FROM cart_items WHERE session_id = ?",[n])}e.s(["addCartItem",()=>n,"clearCart",()=>s,"getCartItems",()=>r,"removeCartItem",()=>i,"updateCartItem",()=>a])},79899,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),i=e.i(61916),s=e.i(14444),o=e.i(37092),u=e.i(69741),d=e.i(16795),p=e.i(87718),l=e.i(95169),c=e.i(47587),g=e.i(66012),h=e.i(70101),E=e.i(26937),R=e.i(10372),y=e.i(93695);e.i(52474);var m=e.i(220),f=e.i(89171),v=e.i(69719),C=e.i(25686),x=e.i(23730),w=e.i(19012),_=e.i(68906),S=e.i(30588);let I=v.z.object({shippingName:v.z.string().min(1),shippingAddressLine1:v.z.string().min(1),shippingAddressLine2:v.z.string().optional(),shippingCity:v.z.string().min(1),shippingPostalCode:v.z.string().min(1),shippingCountry:v.z.string().min(1),shippingPhone:v.z.string().optional(),shippingRegionId:v.z.string().optional(),paymentMethod:v.z.enum(["stripe","paypal"]).optional(),paymentIntentId:v.z.string().optional()});async function O(e){try{let t=await (0,C.getSession)(),r=await e.json(),n=I.parse(r),a=e.env?.DB;if(!a)return f.NextResponse.json({error:"Database not available"},{status:500});let i=e.cookies.get("session-id")?.value||void 0,s=await (0,x.getCartItems)(a,t?.userId,i);if(0===s.length)return f.NextResponse.json({error:"Cart is empty"},{status:400});let o=0,u=[];for(let e of s){let t=await (0,w.getProductById)(a,e.product_id);if(!t)continue;let r=e.variant_id?await (0,w.getProductVariant)(a,e.variant_id):null,n=r?.price??t.price,i=e.quantity,s=n*i;o+=s,u.push({productId:t.id,variantId:r?.id,productName:t.name_en,variantName:r?.name_en||void 0,sku:r?.sku||t.sku||void 0,price:n,quantity:i})}let d=0;if(n.shippingRegionId){let e=await (0,S.getShippingRegionById)(a,n.shippingRegionId);e&&(d=(0,S.calculateShippingCost)(e,o))}let p=.25*o,l=o+d+p,c=await (0,_.createOrder)(a,{userId:t?.userId,email:t?.email||n.shippingName,paymentMethod:n.paymentMethod,paymentIntentId:n.paymentIntentId,subtotal:o,shippingCost:d,tax:p,total:l,shippingRegionId:n.shippingRegionId||void 0,shippingName:n.shippingName,shippingAddressLine1:n.shippingAddressLine1,shippingAddressLine2:n.shippingAddressLine2,shippingCity:n.shippingCity,shippingPostalCode:n.shippingPostalCode,shippingCountry:n.shippingCountry,shippingPhone:n.shippingPhone,items:u});return await (0,x.clearCart)(a,t?.userId,i),f.NextResponse.json({order:{id:c.id,order_number:c.order_number,total:c.total,status:c.status}})}catch(e){if(e instanceof v.z.ZodError)return f.NextResponse.json({error:"Validation failed",details:e.issues},{status:400});return console.error("Create order error:",e),f.NextResponse.json({error:"Failed to create order"},{status:500})}}e.s(["POST",()=>O],46407);var A=e.i(46407);let D=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/checkout/create-order/route",pathname:"/api/checkout/create-order",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/checkout/create-order/route.ts",nextConfigOutput:"standalone",userland:A}),{workAsyncStorage:T,workUnitAsyncStorage:N,serverHooks:q}=D;function P(){return(0,n.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:N})}async function b(e,t,n){D.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/checkout/create-order/route";f=f.replace(/\/index$/,"")||"/";let v=await D.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:C,params:x,nextConfig:w,parsedUrl:_,isDraftMode:S,prerenderManifest:I,routerServerContext:O,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,resolvedPathname:N,clientReferenceManifest:q,serverActionsManifest:P}=v,b=(0,u.normalizeAppPath)(f),M=!!(I.dynamicRoutes[b]||I.routes[N]),H=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,_,!1):t.end("This page could not be found"),null);if(M&&!S){let e=!!I.routes[N],t=I.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await H();throw new y.NoFallbackError}}let B=null;!M||D.isDev||S||(B="/index"===(B=N)?"/":B);let L=!0===D.isDev||!M,k=M&&!L;P&&q&&(0,s.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:q,serverActionsManifest:P,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:P})});let F=e.method||"GET",j=(0,i.getTracer)(),U=j.getActiveScopeSpan(),W={params:x,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>D.onRequestError(e,t,n,O)},sharedContext:{buildId:C}},z=new d.NodeNextRequest(e),$=new d.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(z,(0,p.signalFromNodeResponse)(t));try{let s=async e=>D.handle(K,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${f}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),u=async a=>{var i,u;let d=async({previousCacheEntry:r})=>{try{if(!o&&A&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(a);e.fetchMetrics=W.renderOpts.fetchMetrics;let u=W.renderOpts.pendingWaitUntil;u&&n.waitUntil&&(n.waitUntil(u),u=void 0);let d=W.renderOpts.collectedTags;if(!M)return await (0,g.sendResponse)(z,$,i,W.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,n=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},O),t}},p=await D.handleResponse({req:e,nextConfig:w,cacheKey:B,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:o});if(!M)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(u=p.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let l=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return o&&M||l.delete(R.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||l.get("Cache-Control")||l.set("Cache-Control",(0,E.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(z,$,new Response(p.value.body,{headers:l,status:p.value.status||200})),null};U?await u(U):await j.withPropagatedContext(e.headers,()=>j.trace(l.BaseServerSpan.handleRequest,{spanName:`${F} ${f}`,kind:i.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},u))}catch(t){if(t instanceof y.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})}),M)throw t;return await (0,g.sendResponse)(z,$,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>P,"routeModule",()=>D,"serverHooks",()=>q,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>N],79899)},89119,e=>{e.v(e=>Promise.resolve().then(()=>e(36632)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__edb2f9bf._.js.map